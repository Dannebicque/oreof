<turbo-frame id="tab-content">
    {% set sem = semestre.semestre %}
    {% if semestre == null %}
        Semestre inexistant
    {% else %}
        <header class="border-b border-slate-100 flex justify-between items-center bg-slate-50 p-2">
            <div>
                <div class="flex items-baseline gap-3">
                    <h2 class="text-xl font-black text-slate-800 tracking-tight">
                        Semestre {{ semestreParcours.ordre }}</h2>
                    <span class="px-2 py-1 {% if semestreParcours.isOuvert == false %}bg-red-100 text-red-700{% else %}bg-green-100 text-green-700{% endif %} text-[10px] font-black rounded uppercase">{% if semestreParcours.isOuvert == false %}
                            <i class="fal fa-do-not-enter"></i> Non ouvert{% else %}Ouvert{% endif %}
                    </span>
                    {% if semestre.raccroche == true %}
                        <span class="px-2 py-1 bg-orange-100 text-orange-700 text-[10px] font-black rounded uppercase">
                            <i class="fal fa-chain"></i> Raccroché de {{ semestre.parcoursRaccroche.displayCourt }}
                    </span>
                    {% elseif sem.semestreMutualisables|length > 0 %}
                        <span class="px-2 py-0.5 bg-blue-100 text-blue-700 text-[9px] font-black rounded uppercase tracking-tighter italic">Mutualisé avec :
                    {% for l in sem.semestreMutualisables %}
                        {{ l.parcours.displayCourt }}{% if not loop.last %}, {% endif %}
                    {% endfor %}
                    </span>
                    {% endif %}
                </div>
                <p class="text-xs text-slate-400 font-bold uppercase mt-1">Total horaire
                    : {{ semestre.heuresEctsSemestre.sommeSemestreTotalPres }}
                    heures</p> {# todo à update avec turbo... #}
                <div class="flex items-center gap-4 mt-1" id="valide_semestre_{{ semestreParcours.id }}">
                    {{ include('parcours_v2/_valideSemestre.html.twig') }}
                </div>
            </div>
            <div class="flex gap-3">
                {{ component('dropdown_actions', {
                    label: 'Actions',
                    help: 'Actions disponibles pour ce semestre',
                    icon: 'fal fa-ellipsis-vertical',
                    items: [
                        { label: 'Ajouter une UE au semestre',
                            icon: 'fal fa-plus-circle',
                            disabled: semestre.raccroche,
                            modal: true,
                            color: 'green',
                            url: path('parcours_structure_add_ue_semestre', {parcours:parcours.id, semestreParcours:semestre.semestreParcours.id}) },
                        { label: 'Vérifier le semestre',
                            icon: 'fal fa-refresh',
                            url: path('parcours_v2_semestre_validation', {semestreParcours:semestreParcours.id, parcours: parcours.id}) },
                        { label: 'Déplacer le semestre',
                            icon: 'fal fa-right-left',
                            modal: true,
                            disabled: semestre.raccroche,
                            url: path('structure_semestre_changer', {semestre:sem.id, parcours: parcours.id}) },
                        { label: 'Mutualiser le semestre',
                            modal: true,
                            disabled: semestre.raccroche,
                            icon: 'fal fa-share-nodes',
                            url: path('structure_semestre_mutualiser', {semestre:sem.id, parcours: parcours.id}) },
                        { label: 'Raccrocher un semestre',
                            icon: 'fal fa-link',
                            modal: true,
                            url: path('structure_semestre_raccrocher', {semestre:sem.id, parcours: parcours.id})},
                        { label: 'Réinitialiser le semestre',
                            icon: 'fal fa-trash-alt',
                            disabled: semestre.raccroche,
                            modal: true,
                            url: path('structure_semestre_reinitialiser', {
                            semestre: sem.id,
                            parcours:parcours.id}), danger: true},
                    ]
                }) }}

                <div class="text-right">
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">
                        Total ECTS S{{ semestreParcours.ordre }}
                    </p>
                    <p class="text-2xl font-black text-{% if semestre.heuresEctsSemestre.sommeSemestreEcts < 30 %}red{% else %}green{% endif %}-600">
                        {{ semestre.heuresEctsSemestre.sommeSemestreEcts }} / 30
                    </p>
                </div>


            </div>
        </header>

        {% if validationsIssues is defined and validationsIssues|length > 0 %}
            <div class="border-2 border-red-200 bg-red-50 text-red-800 p-4 rounded-sm flex items-start gap-4 mt-2"
                 role="status"
                 aria-live="polite" aria-atomic="true">
              <span class="p-2 bg-red-100 text-red-700 rounded-full flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 20 20" fill="currentColor"
                     aria-hidden="true">
                  <path fill-rule="evenodd"
                        d="M8.257 3.099c.765-1.36 2.72-1.36 3.486 0l6.518 11.597A1.75 1.75 0 0 1 17.518 17H2.482a1.75 1.75 0 0 1-1.743-2.304L8.257 3.1zM9 7a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0V7z"
                        clip-rule="evenodd"/>
                </svg>
                <span class="sr-only">Erreurs</span>
              </span>

                <div class="flex-1">
                    <p class="font-semibold text-sm">Erreurs dans le semestre</p>

                    <ul class="mt-2 space-y-1 text-sm list-disc list-inside">
                        {% if validationsIssues is defined and validationsIssues|length > 0 %}
                            {% for err in validationsIssues %}
                                <li class="text-red-700">{{ err.ruleCode }} : {{ err|displayMessage }}</li>
                            {% endfor %}
                        {% endif %}
                    </ul>
                </div>
            </div>
        {% endif %}

        <div class="flex-1 overflow-y-auto pt-3 custom-scrollbar">
            {% if semestreParcours.semestre.nonDispense == true %}
                <!-- html -->
                <div
                        class="border-3 border-dashed border-orange-200 bg-orange-50 text-orange-700 p-4 rounded-sm flex items-center justify-between gap-4"
                        role="status" aria-live="polite" aria-atomic="true"
                >
                    <div class="flex items-center gap-4">
                        <!-- icône d'avertissement / état -->
                        <span class="p-3 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center">
                          <!-- exclamation-triangle (accessible) -->
                          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 20 20"
                               fill="currentColor"
                               aria-hidden="true">
                            <path fill-rule="evenodd"
                                  d="M8.257 3.099c.765-1.36 2.72-1.36 3.486 0l6.518 11.597A1.75 1.75 0 0 1 17.518 17H2.482a1.75 1.75 0 0 1-1.743-2.304L8.257 3.1zM9 7a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0V7zm1 7a1.25 1.25 0 1 0 0 2.5A1.25 1.25 0 0 0 10 14z"
                                  clip-rule="evenodd"/>
                          </svg>
                          <span class="sr-only">Semestre non dispensé</span>
                        </span>

                        <div>
                            <p class="font-semibold text-sm">Semestre non dispensé</p>
                            <p class="text-xs text-orange-700/80">
                                Aucun contenu pour ce semestre. Dispenser pour ouvrir la saisie.</p>
                        </div>
                    </div>

                    <div class="flex items-center gap-3">
                        <!-- formulaire POST pour action "dispenser" (Turbo enabled) -->
                        <form method="post" action="" data-turbo="true" class="m-0">
                            <input type="hidden" name="_token"
                                   value="{{ csrf_token('dispense' ~ semestreParcours.semestre.id) }}">
                            <button
                                    type="submit"
                                    class="px-3 py-2 bg-orange-600 text-white rounded-md font-semibold hover:bg-orange-700 focus:outline-none focus:ring-2 focus:ring-orange-400"
                                    aria-label="Dispenser ce semestre"
                            >
                                Dispenser ce semestre
                            </button>
                        </form>
                    </div>
                </div>
            {% else %}
                {% if semestre.raccroche == true %}
                    {{ include('typeDiplome/'~constant('TEMPLATE_FOLDER', typeD)~'/structure/v2/_structure_semestre.html.twig', {
                        ordre:semestreParcours.ordre,
                        presentiel: parcours.modalitesEnseignement.value == 0 or parcours.modalitesEnseignement.value == 1,
                        distanciel: parcours.modalitesEnseignement.value == 2 or parcours.modalitesEnseignement.value == 1,
                        diffSemestre: null}) }}
                {% else %}
                <div
                        data-controller="sortable"
                        data-sortable-type-value="ue"
                        data-sortable-url-value="{{ path('parcours_structure_api_semestre_reorder_ue', {id: semestreParcours.semestre.id}) }}"
                >
                    {% for ue in semestre.ues %}
                        <turbo-frame id="tab-ue-{{ ue.ue.id }}">
                            {{ include('parcours_v2/tabs/_ue.html.twig', {ue:ue}) }}
                        </turbo-frame>
                    {% else %}

                        <twig:alerte type="info">
                            Aucune UE dans ce semestre pour le moment. Pour saisir votre première UE, choisir
                            "Actions"
                            en haut à droite.
                        </twig:alerte>
                    {% endfor %}
                </div>
            {% endif %}
            {% endif %}
        </div>
    {% endif %}
</turbo-frame>
