#bin/console workflow:dump dpe | dot -Tpng -o dpe.png
framework:
  workflows:
    dpeParcours:
      type: 'workflow'
      marking_store:
        type: 'method'
        property: 'etatValidation'
      supports:
        - App\Entity\DpeParcours
      initial_marking: 'initialisation_dpe'
      places:
        initialisation_dpe:
          metadata:
            process: false
            label: 'validation.initialisation'
            color: 'info'
        autorisation_saisie:
          metadata:
            process: false
            label: 'validation.autorisation_saisie'
            color: 'success'
        en_cours_redaction:
          metadata:
            process: true
            icon: 'fa-pencil'
            label: 'en_cours_redaction.parcours'
            hasUpload: false
            isTimeline: false
            check: true
            templateCheck: '_checkParcours.html.twig'
            color: 'info'
        tacite_reconduction:
          metadata:
            process: false
            icon: 'fa-pencil'
            label: 'tacite_reconduction.parcours'
            hasUpload: false
            isTimeline: false
            check: false
            color: 'success'
        soumis_parcours:
          metadata:
            process: true
            icon: 'fa-memo-circle-check'
            label: 'validation.parcours_rf'
            isTimeline: false
            check: true
            templateCheck: '_checkParcours.html.twig'
            color: 'success'
        soumis_dpe_composante:
          metadata:
            process: true
            icon: 'fa-check-to-slot'
            label: 'validation.dpe'
            isTimeline: true
            color: 'success'
        refuse_rf:
          metadata:
            process: false
            label: 'validation.refuse_rf'
            color: 'danger'
        refuse_dpe_composante:
          metadata:
            process: false
            label: 'validation.refuse_dpe_composante'
            color: 'danger'
        soumis_conseil:
          metadata:
            process: true
            icon: 'fa-people-line'
            label: 'validation.conseil'
            isTimeline: true
            hasDate: true
            hasUpload: true
            color: 'success'
        refuse_conseil:
          metadata:
            process: false
            label: 'validation.refuse_conseil'
            color: 'danger'
        refuse_central:
          metadata:
            process: false
            label: 'validation.refuse_central'
            color: 'danger'
        soumis_central:
          metadata:
            process: true
            icon: 'fa-school-circle-check'
            label: 'validation.ses'
            isTimeline: false
            color: 'success'
        soumis_cfvu:
          metadata:
            process: true
            icon: 'fa-shield-check'
            label: 'soumis.cfvu'
            hasDate: true
            isTimeline: true
            color: 'success'
        refuse_definitif_cfvu:
          metadata:
            process: false
            label: 'validation.refuse_definitif_cfvu'
            color: 'danger'
        valide_cfvu:
          metadata:
            process: true
            icon: 'fa-stamp'
            label: 'relecture.avant_publication'
            isTimeline: true
            color: 'success'
        valide_a_publier: # Etape de saisie de la date pour publication post CFVU
          metadata:
            process: true
            icon: 'fa-bullhorn'
            label: 'validation.publication'
            isTimeline: false
            color: 'success'
        publie:
          metadata:
            process: false
            icon: 'fa-bullhorn'
            label: 'publie'
            isTimeline: false
            color: 'success'
        soumis_conseil_reserve:
          metadata:
            process: false
            label: 'validation.soumis_conseil_reserve'
            color: 'warning'
        en_cours_redaction_ss_cfvu:
          metadata:
            process: true
            icon: 'fa-paper-plane'
            isTimeline: false
            label: 'validation.en_cours_redaction_ss_cfvu'
            color: 'info'
        soumis_central_sans_cfvu:
          metadata:
            process: false
            icon: 'fa-school-circle-check'
            isTimeline: false
            label: 'validation.soumis_central_sans_cfvu'
            color: 'success'
        soumis_central_reserve_cfvu:
          metadata:
            process: false
            label: 'validation.soumis_central_reserve_cfvu'
            color: 'warning'
        soumis_dpe_composante_reserve_cfvu:
          metadata:
            process: false
            label: 'validation.soumis_dpe_composante_reserve_cfvu'
            color: 'warning'
        non_ouverture_ses:
          metadata:
            process: false
            label: 'validation.non_ouverture_ses'
            color: 'danger'
        non_ouverture:
          metadata:
            process: false
            label: 'validation.non_ouverture'
            color: 'danger'
      transitions:
        initialiser:
          from: 'initialisation_dpe'
          to: 'autorisation_saisie'
        autoriser:
          from: 'autorisation_saisie'
          to: 'en_cours_redaction'
          metadata:
            recipients: [ 'DPE', 'RF' ]
            titre: 'Autorisation de saisie de la formation %%s'
        valider_parcours: # Soumettre du resp de parcours vers formation
          from: 'en_cours_redaction'
          to: 'soumis_parcours'
          metadata:
            recipients: [ 'RF', 'CoRF' ]
            titre_with_parcours: "Le parcours %%s de votre formation %%s a été soumis à validation"
            titre: 'Un parcours de votre formation %%s a été soumis à validation'
            type: valider
            btn: success
            icon: fa-check
        valider_rf:
          from: 'soumis_parcours'
          to: 'soumis_dpe_composante'
          metadata:
            recipients: [ 'DPE' ]
            titre_with_parcours: 'Le parcours %%s de la formation %%s a été validé par son responsable'
            titre: 'La formation %%s a été validée par son responsable'
            type: valider
            btn: success
            icon: fa-check
        reserver_rf:
          from: 'soumis_parcours'
          to: 'en_cours_redaction'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'Le parcours %%s de la formation %%s a reçu des réserves par le responsable de formation'
            titre: 'Un parcours de la formation %%s a reçu des réserves par le responsable de formation'
            type: reserver
            btn: warning
            icon: fa-circle-exclamation-check
        refuser_dpe_composante:
          from: 'soumis_dpe_composante'
          to: 'refuse_dpe_composante'
          metadata:
            recipients: [ 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'La fiche du parcours %%s de la formation %%s a été refusée par le DPE de votre composante'
            titre: 'La fiche de la formation %%s a été refusée par le DPE de votre composante'
            type: refuser
            btn: danger
            icon: fa-ban
        valider_dpe_composante:
          from: 'soumis_dpe_composante'
          to: 'soumis_conseil'
          metadata:
            recipients: [ 'RF', 'CoRF', 'RP', 'CoRP' ]
            type: valider
            btn: success
            icon: fa-check
        reserver_dpe_composante:
          from: 'soumis_dpe_composante'
          to: 'en_cours_redaction'
          metadata:
            recipients: [ 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'La fiche du parcours %%s de la formation %%s a reçu des réserves de la part du DPE de votre composante'
            titre: 'La fiche de la formation %%s a reçu des réserves de la part du DPE de votre composante'
            type: reserver
            btn: warning
            icon: fa-circle-exclamation-check
        refuser_conseil:
          from: 'soumis_conseil'
          to: 'refuse_conseil'
          metadata:
            recipients: [ 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'La fiche du parcours %%s de la formation %%s a été refusée par le conseil de votre composante'
            titre: 'La fiche de la formation %%s a été refusée par le conseil de votre composante'
            type: refuser
            btn: danger
            icon: fa-ban
        valider_conseil:
          from: 'soumis_conseil'
          to: 'soumis_central'
          metadata:
            recipients: [ 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'La fiche du parcours %%s de la formation %%s a été validée par le conseil de la composante'
            titre: 'La fiche de la formation %%s a été validée par le conseil de la composante'
            type: valider
            btn: success
            hasDate: true
            hasUpload: true
            icon: fa-check
        reserver_conseil:
          from: 'soumis_conseil'
          to: 'en_cours_redaction'
          metadata:
            recipients: [ 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'La fiche du parcours %%s de la formation %%s a recu des réserves par le conseil de la composante'
            titre: 'La fiche de la formation %%s a recu des réserves par le conseil de la composante'
            type: reserver
            btn: warning
            icon: fa-circle-exclamation-check
        refuser_central:
          from: 'soumis_central'
          to: 'refuse_central'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'La fiche du parcours %%s de la formation %%s a été refusée par le SES'
            titre: 'La fiche de la formation %%s a été refusée par le SES'
            type: refuser
            btn: danger
            icon: fa-ban
        valider_central:
          from: 'soumis_central'
          to: 'soumis_cfvu'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'La fiche du parcours %%s de la formation %%s a été validée par le SES'
            titre: 'La fiche de la formation %%s a été validée par le SES'
            type: valider
            btn: success
            icon: fa-check
        reserver_central:
          from: 'soumis_central'
          to: 'en_cours_redaction'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'La fiche du parcours %%s de la formation %%s a reçu des réserves par le SES'
            titre: 'La fiche de la formation %%s a reçue des réserves par le SES'
            type: reserver
            btn: warning
            icon: fa-circle-exclamation-check
        valider_publication_directe:
          from: 'soumis_central'
          to: 'valide_a_publier'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            type: valider
            btn: success
            icon: fa-check
            hasValidLheo: true
        refuser_definitif_cfvu:
          from: 'soumis_cfvu'
          to: 'refuse_definitif_cfvu'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'Votre parcours %%s de la formation %%s a reçu une refus définitif de validation par la CFVU'
            titre: 'Votre formation %%s a reçu une refus définitif de validation par la CFVU'
            hasDate: true
            type: refuser
            btn: danger
            icon: fa-ban
        refuser_revoir_cfvu:
          from: 'soumis_cfvu'
          to: 'en_cours_redaction'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'Votre parcours %%s de la formation %%s a reçu des réserves de la CFVU'
            titre: 'Votre formation %%s a reçu des réserves de la CFVU'
            hasDate: true
            type: reserver
            btn: warning
            icon: fa-circle-exclamation-check
        valider_reserve_cfvu:
          from: 'soumis_cfvu'
          to: 'soumis_dpe_composante_reserve_cfvu'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'Votre parcours %%s de la formation %%s a été validé par la CFVU'
            titre: 'Votre formation %%s a été validée par la CFVU'
            type: valider
            btn: success
            icon: fa-check
            display: false
        transmetre_reserve_cfvu:
          from: 'soumis_dpe_composante_reserve_cfvu'
          to: 'soumis_central_reserve_cfvu'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            type: valider
            btn: success
            icon: fa-check
        valider_reserve_conseil_cfvu:
          from: 'soumis_cfvu'
          to: 'soumis_conseil_reserve' #todo mais on court-circuite le retour directement vers valider publicatio
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'Votre parcours %%s de la formation %%s a été validé par la CFVU'
            titre: 'Votre formation %%s a été validée par la CFVU'
            type: valider
            btn: success
            icon: fa-check
            display: false
        valider_reserve_central_cfvu:
          from: 'soumis_conseil_reserve'
          to: 'valide_cfvu'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'Votre parcours %%s de la formation %%s a été validé par la CFVU'
            titre: 'Votre formation %%s a été validée par la CFVU'
            type: valider
            btn: success
            icon: fa-check
        valider_cfvu:
          from: 'soumis_cfvu'
          to: 'valide_cfvu'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'Votre parcours %%s de la formation %%s a été validé par la CFVU'
            titre: 'Votre formation %%s a été validée par la CFVU'
            type: valider
            btn: success
            hasDate: true
            icon: fa-check
        valider_publication:
          from: 'valide_cfvu'
          to: 'valide_a_publier'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            type: valider
            btn: success
            icon: fa-check
            hasDate: true
            hasValidLheo: true
        publier:
          from: 'valide_a_publier'
          to: 'publie'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            type: valider
            btn: success
            icon: fa-check
        relancer_annee:
          from: 'publie'
          to: 'tacite_reconduction'
        reouvrir_tacite:
          from: 'tacite_reconduction'
          to: 'en_cours_redaction'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
        reouvrir_mccc:
          from: 'publie'
          to: 'en_cours_redaction'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
        reouvrir_avant_publie:
          from: 'valide_a_publier'
          to: 'en_cours_redaction'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
        reouvrir_sans_cfvu:
          from: 'publie'
          to: 'en_cours_redaction_ss_cfvu'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
        valider_ouverture_sans_cfvu:
          from: 'en_cours_redaction_ss_cfvu'
          to: 'soumis_central_sans_cfvu'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'Parcours %%s de la formation %%s a été modifié sans passage en CFVU'
            titre: 'Formation %%s a été modifiée sans passage en CFVU'
            type: valider
            btn: success
            icon: fa-check
        valider_transmettre_ouverture_sans_cfvu:
          from: 'soumis_central_sans_cfvu'
          to: 'valide_a_publier'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'La fiche du parcours %%s de la formation %%s a été validée par le SES et va être publié'
            titre: 'La fiche de la formation %%s a été validée par le SES et va être publiée'
            type: valider
            btn: success
            hasDate: true
            hasValidLheo: true
            icon: fa-check
        reserver_transmettre_ouverture_sans_cfvu:
          from: 'soumis_central_sans_cfvu'
          to: 'en_cours_redaction_ss_cfvu'
          metadata:
            recipients: [ 'DPE', 'RF', 'CoRF', 'RP', 'CoRP' ]
            titre_with_parcours: 'La fiche du parcours %%s de la formation %%s a reçu des réserves par le SES'
            titre: 'La fiche de la formation %%s a reçue des réserves par le SES'
            type: reserver
            btn: warning
            icon: fa-circle-exclamation-check
        valider_transmettre_reserve_cfvu:
          from: 'soumis_central_reserve_cfvu'
          to: 'valide_cfvu'
          metadata:
            type: valider
            btn: success
            icon: fa-check
        reserver_transmettre_reserve_cfvu:
          from: 'soumis_central_reserve_cfvu'
          to: 'soumis_dpe_composante_reserve_cfvu'
          metadata:
            type: reserver
            btn: warning
            icon: fa-circle-exclamation-check
        valider_non_ouverture_ses:
          from: 'non_ouverture_ses'
          to: 'non_ouverture'
          metadata:
            type: valider
            btn: success
            icon: fa-check
    composante: # todo: Deprecated pas utilisé ?
      type: 'workflow'
      marking_store:
        type: 'method'
        property: 'etatComposante'
      supports:
        - App\Entity\Composante
      initial_marking: 'initialisation_composante'
      places:
        - 'initialisation_composante'
        - 'en_cours_redaction'
        - 'soumis_ses'
        - 'refuse_dpe'
      transitions:
        initialiser:
          guard: "is_granted('ROLE_RESP_DPE')"
          from: 'initialisation_composante'
          to: 'en_cours_redaction'
        valider_resp_dpe:
          from: 'en_cours_redaction'
          to: 'soumis_ses'
        refuser_resp_dpe:
          from: 'en_cours_redaction'
          to: 'refuse_dpe'
    fiche:
      type: 'workflow'
      marking_store:
        type: 'method'
        property: 'etatFiche'
      supports:
        - App\Entity\FicheMatiere
      initial_marking: 'en_cours_redaction'
      places:
        'en_cours_redaction':
          metadata:
            process: true
            icon: 'fa-ballot-check'
            label: 'validation.fiche_matiere'
            hasValid: true
            hasReserve: false
            hasRefuse: false
            hasUpload: false
            isTimeline: false
            hasDate: false
            transition: 'en_cours_redaction'
            canValide: 'valider_fiche_compo'
            check: true
            color: 'info'
        'soumis_central':
          metadata:
            process: true
            icon: 'fa-school-circle-check'
            label: 'validation.fiche_matiere.ses'
            hasValid: true
            hasReserve: true
            hasRefuse: true
            hasUpload: false
            isTimeline: false
            hasDate: false
            transition: 'transmis_ses'
            canValide: 'valider_fiche_ses'
            canRefuse: 'refuser_fiche_ses'
            canReserve: 'reserver_fiche_ses'
            color: 'warning'
        'valide_pour_publication':
          metadata:
            process: true
            icon: 'fa-stamp'
            label: 'validation.fiche_matiere.publication'
            hasValid: false
            hasReserve: false
            hasRefuse: false
            hasUpload: false
            isTimeline: true
            hasDate: false
            transition: 'transmis_pour_publication'
            canValide: 'valider_fiche_pour_publication'
            color: 'success'
        'publie':
          metadata:
            process: false
            showOn: false
            icon: 'fa-pencil'
            label: 'fiche_matiere.rouvrir_fiche_matiere'
            hasValid: false
            hasReserve: false
            hasRefuse: false
            hasUpload: false
            isTimeline: false
            hasDate: false
            transition: 'publie'
            canValide: ''
            color: 'success'
      transitions:
        valider_fiche_compo:
          from: 'en_cours_redaction'
          to: 'soumis_central'
          metadata:
            type: valider
            btn: success
            icon: 'fa-ballot-check'
        valider_fiche_ses:
          from: 'soumis_central'
          to: 'valide_pour_publication'
          metadata:
            type: valider
            btn: success
            icon: 'fa-stamp'
        reserver_fiche_ses:
          from: 'soumis_central'
          to: 'en_cours_redaction'
          metadata:
            type: reserver
            btn: warning
            icon: fa-check
        publier:
          from: 'valide_pour_publication'
          to: 'publie'
          metadata:
        rouvrir_fiche_matiere:
          from: 'publie'
          to: 'en_cours_redaction'
          metadata:
            type: valider
            btn: warning
            icon: 'fa-pencil'
        rouvrir_fiche_matiere_b:
          from: 'soumis_central'
          to: 'en_cours_redaction'
          metadata:
            type: valider
            btn: warning
            icon: 'fa-pencil'
    changeRf:
      type: 'workflow'
      marking_store:
        type: 'method'
        property: 'etatDemande'
      supports:
        - App\Entity\ChangeRf
      initial_marking: 'demande_initialisee'
      places:
        demande_initialisee:
          metadata:
            process: true
            label: 'validation.demande_initialisee'
            color: 'info'
        soumis_conseil:
          metadata:
            process: true
            icon: 'fa-people-line'
            label: 'validation.soumis_conseil'
            color: 'success'
        soumis_ses:
          metadata:
            process: true
            icon: 'fa-school-circle-check'
            label: 'validation.soumis_ses'
            color: 'success'
        soumis_cfvu:
          metadata:
            process: true
            icon: 'fa-shield-check'
            label: 'validation.soumis_cfvu'
            color: 'success'
        attente_pv:
          metadata:
            process: false
            label: 'validation.attente_pv'
            color: 'warning'
        effectuee:
          metadata:
            process: false
            label: 'validation.effectuee'
            color: 'success'
        verification_pv:
          metadata:
            process: false
            label: 'validation.verification_pv'
            color: 'warning'
      transitions:
        effectuer_demande:
          from: 'demande_initialisee'
          to: 'soumis_conseil'
        valider_conseil:
          from: 'soumis_conseil'
          to: 'soumis_ses'
          metadata:
            type: valider
            btn: success
            icon: fa-check
            hasDate: true
            hasUpload: true
        valider_ses:
          from: 'soumis_ses'
          to: 'soumis_cfvu'
          metadata:
            type: valider
            btn: success
            icon: fa-check
        reserver_ses:
          from: 'soumis_ses'
          to: 'demande_initialisee'
          metadata:
            type: reserver
            btn: warning
            icon: fa-circle-exclamation-check
        valider_cfvu_avec_pv:
          from: 'soumis_cfvu'
          to: 'effectuee'
          metadata:
            type: valider
            btn: success
            icon: fa-check
            hasDate: true
        valider_cfvu_attente_pv:
          from: 'soumis_cfvu'
          to: 'attente_pv'
          metadata:
            type: valider
            btn: success
            icon: fa-check
            hasDate: true
        reserver_cfvu:
          from: 'soumis_cfvu'
          to: 'demande_initialisee'
          metadata:
            type: reserver
            btn: warning
            icon: fa-circle-exclamation-check
        deposer_pv:
          from: 'attente_pv'
          to: 'verification_pv' #etape intermédiaire de contrôle
          metadata:
            type: valider
            btn: success
            icon: fa-check
            hasUpload: true
        valider_pv:
          from: 'verification_pv'
          to: 'effectuee'
          metadata:
            type: valider
            btn: success
            icon: fa-check
